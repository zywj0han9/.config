# ===================================================================
#  跨平台适配配置 (Platform-specific Configuration) - v2 (已重构)
#  ~/.config/tmux/conf.d/platform.conf
# ===================================================================
#
#  职责:
#  - 检测操作系统, 并设置平台相关的变量供其他模块使用.
#  - 统一处理剪贴板命令.
#
#  注意: 键位绑定、颜色、具体插件配置等已移至对应模块.
#

# -------------------------------------------------------------------
# 1. 设置平台标识变量
# -------------------------------------------------------------------
# 这些 @ 变量可被其他 .conf 文件中的 Tmux 格式化字符串引用.
set -g @is_macos "0"
set -g @is_linux "0"
set -g @is_wsl "0"

if-shell 'uname -s | grep -q "Darwin"' 'set -g @is_macos "1"'
if-shell 'uname -s | grep -q "Linux" && test -z "$WSL_DISTRO_NAME"' 'set -g @is_linux "1"'
if-shell 'uname -s | grep -q "Linux" && test -n "$WSL_DISTRO_NAME"' 'set -g @is_wsl "1"'


# -------------------------------------------------------------------
# 2. 统一剪贴板命令
# -------------------------------------------------------------------
# 将具体的复制命令存储在 @copy_command 变量中, 供 keys.conf 使用.

# macOS
if-shell 'test #{@is_macos} -eq 1' \
    'set -g @copy_command "pbcopy"'

# Linux (优先使用 Wayland 的 wl-copy)
if-shell 'test #{@is_linux} -eq 1' \
    "if-shell 'command -v wl-copy' \
        'set -g @copy_command \"wl-copy\"' \
        'set -g @copy_command \"xclip -i -selection clipboard\"'" # 回退到 xclip

# WSL
if-shell 'test #{@is_wsl} -eq 1' \
    'set -g @copy_command "clip.exe"'


# -------------------------------------------------------------------
# 3. 修复 macOS 的 Option 键和剪贴板访问
# -------------------------------------------------------------------
# `reattach-to-user-namespace` 是一个经典的 macOS 修复工具.
# 您可能需要通过 `brew install reattach-to-user-namespace` 来安装它.

if-shell 'test #{@is_macos} -eq 1' \
    'set -g default-command "reattach-to-user-namespace -l $SHELL"'
